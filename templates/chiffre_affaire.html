{% extends "base.html" %}
{% block title %}Chiffre d'affaires{% endblock %}

{% block content %}

<div class="header-row">
    <h1>Chiffre d'affaires</h1>
</div>

<!-- ===================== FORMULAIRE AJOUT ===================== -->

<div class="card">
    <h2>Ajouter une entrée</h2>

    <form method="post">
        <label>Commercial</label>
        <input type="text" name="commercial" required placeholder="ex : Julien">

        <label>Montant (€)</label>
        <input type="number" step="0.01" name="montant" required>

        <label>Date</label>
        <input type="date" name="date" required value="{{ today }}">

        <button class="btn" style="margin-top:1rem;">Ajouter</button>
    </form>
</div>


<!-- ===================== RÉSUMÉ ===================== -->

<div class="card">
    <h2>Résumé</h2>

    <p><strong>CA global :</strong> {{ ca_global }} €</p>

    <h3>CA par commercial :</h3>

    {% if ca_par_com %}
        <ul>
            {% for com, montant in ca_par_com.items() %}
                <li><strong>{{ com }}</strong> : {{ montant }} €</li>
            {% endfor %}
        </ul>
    {% else %}
        <p>Aucune entrée enregistrée.</p>
    {% endif %}
</div>


<!-- ===================== TABLEAU DES ENTRÉES ===================== -->

<div class="card">
    <h2>Détails des entrées</h2>

    <table class="table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Commercial</th>
                <th>Montant (€)</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody>
            {% for r in revenus %}
            <tr>
                <td>{{ r.date.strftime("%d/%m/%Y") }}</td>
                <td>{{ r.commercial }}</td>
                <td>{{ r.montant }} €</td>
                <td class="actions">
                    <form method="post" action="{{ url_for('delete_revenue', rev_id=r.id) }}"
                          onsubmit="return confirm('Supprimer cette entrée ?');">
                        <button class="danger">Supprimer</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if revenus|length == 0 %}
        <p>Aucune entrée pour le moment.</p>
    {% endif %}
</div>

{% endblock %}
